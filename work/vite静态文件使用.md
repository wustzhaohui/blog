## requireä¸ºä»€ä¹ˆä¼šæŠ¥é”™å‘¢ï¼Ÿçœ‹çœ‹ğŸ¤”é¢å®˜æ–¹çš„è§£é‡Š

> CJS çš„ Node API å·²ç»è¢«åºŸå¼ƒã€‚å½“è°ƒç”¨ `require('vite')` æ—¶ï¼Œå°†ä¼šè®°å½•ä¸€ä¸ªåºŸå¼ƒè­¦å‘Šã€‚ä½ åº”è¯¥æ›´æ–°ä½ çš„æ–‡ä»¶æˆ–æ¡†æ¶æ¥å¯¼å…¥ Vite çš„ ESM æ„å»ºã€‚
>
> åœ¨ä¸€ä¸ªåŸºç¡€çš„ Vite é¡¹ç›®ä¸­ï¼Œè¯·ç¡®ä¿ï¼š
>
> 1. `vite.config.js` é…ç½®æ–‡ä»¶çš„å†…å®¹ä½¿ç”¨ ESM è¯­æ³•ã€‚
> 2. æœ€è¿‘çš„ `package.json` æ–‡ä»¶ä¸­æœ‰ `"type": "module"`ï¼Œæˆ–è€…ä½¿ç”¨ `.mjs`/`.mts` æ‰©å±•åï¼Œä¾‹å¦‚ `vite.config.mjs` æˆ–è€… `.vite.config.mts`ã€‚
>
> å¯¹äºå…¶ä»–é¡¹ç›®ï¼Œæœ‰å‡ ç§å¸¸è§çš„æ–¹æ³•ï¼š
>
> - **é…ç½® ESM ä¸ºé»˜è®¤ï¼Œå¦‚æœéœ€è¦åˆ™é€‰æ‹© CJSï¼š** åœ¨é¡¹ç›® `package.json` ä¸­æ·»åŠ  `"type": "module"`ã€‚æ‰€æœ‰ `*.js` æ–‡ä»¶ç°åœ¨éƒ½è¢«è§£é‡Šä¸º ESMï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨ ESM è¯­æ³•ã€‚ä½ å¯ä»¥å°†ä¸€ä¸ªæ–‡ä»¶é‡å‘½åä¸º `.cjs` æ‰©å±•åæ¥ç»§ç»­ä½¿ç”¨ CJSã€‚
> - **ä¿æŒ CJS ä¸ºé»˜è®¤ï¼Œå¦‚æœéœ€è¦åˆ™é€‰æ‹© ESMï¼š** å¦‚æœé¡¹ç›® `package.json` æ²¡æœ‰ `"type": "module"`ï¼Œæ‰€æœ‰ `*.js` æ–‡ä»¶éƒ½è¢«è§£é‡Šä¸º CJSã€‚ä½ å¯ä»¥å°†ä¸€ä¸ªæ–‡ä»¶é‡å‘½åä¸º `.mjs` æ‰©å±•åæ¥ä½¿ç”¨ ESMã€‚
> - **åŠ¨æ€å¯¼å…¥ Viteï¼š** å¦‚æœä½ éœ€è¦ç»§ç»­ä½¿ç”¨ CJSï¼Œä½ å¯ä»¥ä½¿ç”¨ `import('vite')` åŠ¨æ€å¯¼å…¥ Viteã€‚è¿™è¦æ±‚ä½ çš„ä»£ç å¿…é¡»åœ¨ä¸€ä¸ª `async` ä¸Šä¸‹æ–‡ä¸­ç¼–å†™ï¼Œä½†æ˜¯ç”±äº Vite çš„ API å¤§å¤šæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥åº”è¯¥è¿˜æ˜¯å¯ä»¥ç®¡ç†çš„ã€‚
>
> æŸ¥çœ‹ [æ’é”™æŒ‡å—](https://cn.vitejs.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated) è·å–æ›´å¤šä¿¡æ¯ã€‚

## è®¾ç½®srcç›®å½•åˆ«å

å’Œ`webpack`ä¸€æ ·ï¼Œåœ¨é¡¹ç›®å¼•å…¥é™æ€èµ„æºçš„æ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨`@`ä½œä¸ºæŒ‡å‘`src`çš„ç›®å½•ã€‚[å®˜æ–¹æ–‡æ¡£](https://webpack.docschina.org/configuration/resolve#resolvealias)

åœ¨webpackä¸­æˆ‘ä»¬éœ€è¦è¿™ä¹ˆé…ç½®â¬‡ï¸

```tsx
const path = require('path');

module.exports = {
  //...
  resolve: {
    alias: {
      Utilities: path.resolve(__dirname, 'src/utilities/'),
      Templates: path.resolve(__dirname, 'src/templates/'),
      '@': path.resolve(__dirname, 'src/'),
    },
  },
};
```

é€šè¿‡ä»¥ä¸Šçš„é…ç½®ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è®¿é—®åˆ°`src/utilities/index.ts`æ–‡ä»¶å¯ä»¥ç›´æ¥ç®€å†™æˆ`Utilities/index.ts`ï¼Œæˆ‘ä»¬æƒ³è¦è®¿é—®åˆ°`src`ä¸‹çš„æ–‡ä»¶çš„è¯å¯ä»¥ç›´æ¥ä½¿ç”¨`@`æ¥ç›´æ¥æŒ‡å‘`src`ç›®å½•ã€‚

åœ¨`vite`ä¸­ä¸­å¯ä»¥è¿™ä¹ˆé…ç½®â¬‡ï¸ã€‚[å®˜æ–¹æ–‡æ¡£](https://cn.vitejs.dev/config/shared-options.html#resolve-alias)

```tsx
{
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src')
    }
  }
}
```

åŒ`webpack`ä¸Šä¾‹å­ğŸŒ°ä¸€æ ·ä½¿ç”¨ã€‚

## æ¥ä¸‹æ¥ è¯•è¯•å¦‚ä½•åœ¨é¡¹ç›®ä¸­æ­£ç¡®çš„ä½¿ç”¨é™æ€èµ„æºå¼•å…¥

å¯ä»¥å»çœ‹ä¸‹Viteå®˜æ–¹æºäº[é™æ€èµ„æº](https://cn.vitejs.dev/guide/assets.html)çš„çš„è§£é‡Šã€‚

viteå®˜æ–¹å…³äºé™æ€èµ„æºå¼•å…¥åˆ†ä¸ºå¦‚ä¸‹å‡ ç‚¹

- å°†èµ„æºå¼•å…¥ä¸º URL

  - [æ˜¾å¼ URL å¼•å…¥](https://cn.vitejs.dev/guide/assets.html#explicit-url-imports)

  - [å°†èµ„æºå¼•å…¥ä¸ºå­—ç¬¦ä¸²](https://cn.vitejs.dev/guide/assets.html#importing-asset-as-string)

  - [å¯¼å…¥è„šæœ¬ä½œä¸º Worker](https://cn.vitejs.dev/guide/assets.html#importing-script-as-a-worker)
  - [public ç›®å½•](https://cn.vitejs.dev/guide/assets.html#the-public-directory)

- [new URL(url, import.meta.url)](https://cn.vitejs.dev/guide/assets.html#new-url-url-import-meta-url)

## å¸¸ç”¨çš„é™æ€èµ„æºå¼•å…¥

ä»¥ä¸Šæ˜¯å®˜æ–¹ç»™åˆ°çš„è§£é‡Šï¼Œæˆ‘ä»¬åœ¨é…ç½®å®Œæˆ`@`çš„åˆ«åä¹‹åï¼Œæƒ³è¦è®¿é—®`src`ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½å¯ä»¥ç›´æ¥`import xxx from '@/xx'`

åœ¨å¼•å…¥é™æ€å›¾ç‰‡çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥è¿™ä¹ˆå†™â¬‡ï¸ã€‚



### æ–‡ä»¶æ”¾åœ¨`src/assets/images`æ–‡ä»¶å¤¹

```tsx
import img1 from '@/assets/images/xxx.jpg'

// ä½¿ç”¨çš„æ—¶å€™å¯ä»¥ç›´æ¥
<img :src="img1" />
  
// å½“ç„¶åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾ç¤ºçš„å¼•å…¥ä¸ºurl
  import img1 from '@/assets/images/xxx.jpg?url'
// ä½¿ç”¨åŒä¸Š
```

å¤§å¤šæ•°æˆ‘ä»¬å¼•å…¥é™æ€æ–‡ä»¶éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨å¦‚ä¸Šå†™æ³•ã€‚

### æ–‡ä»¶æ”¾åœ¨publicæ–‡ä»¶å¤¹

å¦‚æœä½ å°†æ–‡ä»¶æ”¾åœ¨publicæ–‡ä»¶å¤¹éœ€è¦æ³¨æ„âš ï¸ä»¥ä¸‹å‡ ç‚¹

> - ä¸ä¼šè¢«æºç å¼•ç”¨ï¼ˆä¾‹å¦‚ `robots.txt`ï¼‰
> - å¿…é¡»ä¿æŒåŸæœ‰æ–‡ä»¶åï¼ˆæ²¡æœ‰ç»è¿‡ hashï¼‰
> - ...æˆ–è€…ä½ å‹æ ¹ä¸æƒ³å¼•å…¥è¯¥èµ„æºï¼Œåªæ˜¯æƒ³å¾—åˆ°å…¶ URLã€‚

å¦‚æœä½ æ²¡æœ‰é…ç½® [`publicDir`](https://cn.vitejs.dev/config/shared-options.html#publicdir)é»˜è®¤è®¿é—®è·¯å¾„ä¸º`<root>/public`ï¼Œæ¯”å¦‚ä½ æ”¾åœ¨pulicçš„æ ¹ç›®å½•çš„ä¸€ä¸ªæ–‡ä»¶åç§°ä¸º`img.png`ã€‚è®¿é—®çš„æ—¶å€™å¯ä»¥ç›´æ¥`/img.png`å°±å¯ä»¥è®¿é—®åˆ°ã€‚



## æˆ‘é‡åˆ°çš„é—®é¢˜

æˆ‘çš„åœºæ™¯æ˜¯åœ¨`vue3`ä¸­å°è£…ğŸ“¦ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘éœ€è¦åŠ¨æ€è®¾ç½®ç»„ä»¶å†…éƒ¨çš„ä¸€ä¸ª`dom`çš„èƒŒæ™¯å›¾ç‰‡ã€‚

æˆ‘çš„åšæ³•æ˜¯å°†éœ€è¦ä½¿ç”¨åˆ°çš„èƒŒæ™¯å›¾ç‰‡æ–‡ä»¶ç»Ÿä¸€é‡å‘½åï¼Œç„¶åä½¿ç”¨è¯¥å›¾ç‰‡çš„æ—¶å€™é…ç½®ä¸€ä¸ªæ–‡ä»¶å`props`å°±å¯ä»¥è®¿é—®åˆ°ã€‚å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¥èµ‹å€¼ç»™åˆ°éœ€è¦æ›´æ”¹èƒŒæ™¯å›¾ç‰‡çš„`dom`ã€‚â¬‡ï¸

```
<div :style="style"></div>

const style = {
    background: `url(/src/assets/images/${props.fileName})`
}
```

å¦‚ä¸Šå†™æ³•åœ¨`dev`ç¯å¢ƒæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯èŠ‚æ‰¾ä¸åˆ°åœ°å€äº†ã€‚



ä¸€è„¸æ‡µé€¼çš„æˆ‘å¼€å§‹æ’æŸ¥ã€‚æ‰“åŒ…åæ‰¾ä¸åˆ°ç»åœ°åœ°å€`/src/assets/xxx`ï¼Œæ‰“åŒ…ä¹‹åæ ¹ç›®å½•åªæœ‰ä¸€ä¸ª`assets`æ–‡ä»¶å¤¹æ‰€ä»¥æ‰¾ä¸åˆ°ã€‚



è§£å†³æ–¹æ¡ˆå¦‚ä¸‹â¬‡ï¸

```tsx
function getImageUrl(name) {
  return new URL(`./dir/${name}.png`, import.meta.url).href
}
```

è‡³æ­¤å®Œç¾è§£å†³ã€‚



